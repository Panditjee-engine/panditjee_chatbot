import matplotlib.pyplot as plt
from collections import Counter

# Helper function to reduce a number to a single digit (or Master Numbers)
def reduce_to_single_digit(number):
    while number > 9 and number not in {11, 22, 33}:  # Master Numbers
        number = sum(int(digit) for digit in str(number))
    return number

# Numerology Calculations
def calculate_life_path_number(birth_date):
    digits = [int(d) for d in birth_date if d.isdigit()]
    total = sum(digits)
    return reduce_to_single_digit(total)

def calculate_expression_number(full_name):
    letter_values = {chr(i + 96): i for i in range(1, 27)}  # Map a-z to 1-26
    total = sum(letter_values[char.lower()] for char in full_name if char.isalpha())
    return reduce_to_single_digit(total)

def calculate_soul_urge_number(full_name):
    vowels = "aeiou"
    letter_values = {chr(i + 96): i for i in range(1, 27)}  # Map a-z to 1-26
    total = sum(letter_values[char.lower()] for char in full_name if char.lower() in vowels)
    return reduce_to_single_digit(total)

def get_planet_association(number):
    planet_mapping = {
        1: "Sun",
        2: "Moon",
        3: "Jupiter",
        4: "Rahu",
        5: "Mercury",
        6: "Venus",
        7: "Ketu",
        8: "Saturn",
        9: "Mars",
        11: "Moon (Master Number)",
        22: "Uranus (Master Number)",
        33: "Venus (Master Number)",
    }
    return planet_mapping.get(number, "Unknown")

# Lo Shu Grid Calculation
def create_lo_shu_grid(birth_date):
    digits = [int(d) for d in birth_date if d.isdigit()]
    digit_counts = Counter(digits)
    grid_structure = {
        1: "Determination, Leadership",
        2: "Relationships, Sensitivity",
        3: "Communication, Creativity",
        4: "Practicality, Organization",
        5: "Freedom, Adaptability",
        6: "Responsibility, Nurturing",
        7: "Spirituality, Introspection",
        8: "Wealth, Power",
        9: "Wisdom, Ambition"
    }
    lo_shu_grid = {num: digit_counts.get(num, 0) for num in range(1, 10)}
    interpretations = []
    for num, count in lo_shu_grid.items():
        if count == 0:
            interpretations.append(f"Missing {num}: Challenges in {grid_structure[num]}")
        elif count > 1:
            interpretations.append(f"Repeated {num}: Strong traits in {grid_structure[num]} ({count} times)")
        else:
            interpretations.append(f"Balanced {num}: Natural alignment with {grid_structure[num]}")
    return lo_shu_grid, interpretations

# Visual Representation of Lo Shu Grid
def plot_lo_shu_grid(lo_shu_grid):
    fig, ax = plt.subplots(figsize=(6, 6))
    ax.set_xlim(0, 3)
    ax.set_ylim(0, 3)
    
    # Draw grid lines
    for x in range(1, 3):
        ax.axvline(x, color="black", linewidth=1)
        ax.axhline(x, color="black", linewidth=1)
    
    # Populate grid with counts
    positions = [(2, 0), (2, 1), (2, 2), (1, 0), (1, 1), (1, 2), (0, 0), (0, 1), (0, 2)]
    for i, (x, y) in enumerate(positions, start=1):
        count = lo_shu_grid[i]
        ax.text(y + 0.5, x + 0.5, f"{i} ({count})", ha="center", va="center", fontsize=12, color="blue")
    
    ax.set_xticks([])
    ax.set_yticks([])
    plt.title("Lo Shu Grid", fontsize=16)
    plt.show()

# Main Program
if __name__ == "__main__":
    print("Welcome to the Combined Numerology and Lo Shu Grid Calculator!")
    
    # Input birth date
    birth_date = input("Enter your date of birth (DD-MM-YYYY): ")
    
    # Numerology Calculations
    life_path_number = calculate_life_path_number(birth_date)
    life_path_planet = get_planet_association(life_path_number)
    
    # Input full name
    full_name = input("Enter your full name: ")
    expression_number = calculate_expression_number(full_name)
    soul_urge_number = calculate_soul_urge_number(full_name)
    expression_planet = get_planet_association(expression_number)
    soul_urge_planet = get_planet_association(soul_urge_number)
    
    # Lo Shu Grid Calculation
    lo_shu_grid, lo_shu_interpretations = create_lo_shu_grid(birth_date)
    
    # Display Results
    print("\nðŸ”® Numerology Results ðŸ”®")
    print(f"Life Path Number: {life_path_number} (Planet: {life_path_planet})")
    print(f"Expression Number: {expression_number} (Planet: {expression_planet})")
    print(f"Soul Urge Number: {soul_urge_number} (Planet: {soul_urge_planet})")
    
    print("\nðŸ”® Your Lo Shu Grid ðŸ”®")
    for row in [[4, 9, 2], [3, 5, 7], [8, 1, 6]]:
        print(" | ".join(f"{lo_shu_grid[num]} ({num})" for num in row))
    
    print("\nðŸ”‘ Lo Shu Grid Interpretations:")
    for interpretation in lo_shu_interpretations:
        print(f"- {interpretation}")
    
    # Visualize Lo Shu Grid
    plot_lo_shu_grid(lo_shu_grid)
